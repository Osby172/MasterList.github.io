<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Almacén de Partes - Master List</title>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script>

    <style>
  html, body {
    height: 100%;
    margin: 0;
    background-image: url("https://drive.google.com/uc?export=view&id=194w_L-STqzghdWJvo8rgPaGXv2C8Jh7l");
    background-size: cover;
    background-position: center;
    background-attachment: fixed;
    background-repeat: no-repeat;
  }

        .navbar {
            background: linear-gradient(90deg, #002b5c, #00509e);
        }
        .navbar-brand {
            color: #ffffff !important;
            font-weight: 600;
            letter-spacing: 0.05em;
        }
        .navbar .nav-link {
            color: #ffd166 !important;
            font-weight: 500;
        }
        .navbar .nav-link.active {
            color: #002b5c !important;
            background-color: #ffd166;
            border-radius: 999px;
            padding-inline: 16px;
        }

        .page-section {
            max-width: 95%;
            margin: 20px auto;
            background-color: rgba(255, 255, 255, 0.96);
            border-radius: 12px;
            box-shadow: 0px 6px 16px rgba(0, 0, 0, 0.25);
            padding: 20px;
            display: none; 
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }
        thead {
            background: linear-gradient(90deg, #004b8d, #00a3e0);
            position: sticky;
            top: 0;
            z-index: 1;
            color: #ffffff;
            font-weight: 600;
            letter-spacing: 0.03em;
        }
        th, td {
            padding: 8px;
            text-align: center;
            border: 1px solid #dee2e6;
            font-size: 0.9rem;
        }
        tbody tr:hover {
            background-color: #f1f9ff;
        }

        #searchInputIndex {
            border-radius: 999px;
            border: 2px solid #ffd166 !important;
            padding: 6px 16px;
            font-size: 0.95rem;
            text-align: center;
            width: 800px;
            max-width: 100%;
        }

        #searchInputAvanzada {
            display: block;
            margin: 0 auto 1rem auto;
            width: 500px;
            max-width: 100%;
            text-align: center;
            border-radius: 999px;
            border: 2px solid #ffd166;
            padding: 8px 16px;
        }

        #dataTable thead {
            position: sticky;
            top: 0;
        }
        #dataTable tbody {
            display: block;
            max-height: 70vh;
            overflow-y: auto;
            width: 100%;
        }
        #dataTable thead,
        #dataTable tbody tr {
            display: table;
            width: 100%;
            table-layout: fixed;
        }
        .tabla-img {
            width: 200px;
            height: 200px;
            object-fit: cover;
            cursor: zoom-in;
        }

        .img-overlay[hidden] { display: none; }
        .img-overlay {
            position: fixed;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(10, 10, 10, 0.9);
            z-index: 10000;
        }
        .img-overlay img {
            width: 100vw;
            height: 100vh;
            object-fit: contain;
        }
        .img-overlay .close {
            position: fixed;
            top: 16px;
            right: 16px;
            width: 44px;
            height: 44px;
            border: 0;
            border-radius: 6px;
            background: rgba(0, 0, 0, 0.6);
            color: #fff;
            font-size: 28px;
            line-height: 1;
            cursor: pointer;
        }
        .img-overlay .close:hover {
            background: rgba(0, 0, 0, 0.8);
        }

        #searchBarTarjetas {
            width: 100%;
            padding: 12px 16px;
            margin: 15px 0;
            font-size: 18px;
            border: 2px solid #ffd166;
            border-radius: 999px;
            box-sizing: border-box;
            text-align: center;
        }
        #excelTableTarjetas {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            background: white;
            font-size: 16px;
        }
        #excelTableTarjetas th, #excelTableTarjetas td {
            border: 1px solid #dee2e6;
            padding: 10px;
            text-align: center;
        }
        #excelTableTarjetas th {
            background: linear-gradient(90deg, #004b8d, #00a3e0);
            color: white;
            font-weight: 600;
        }
        #excelTableTarjetas tbody tr:hover {
            background-color: #f1f9ff;
        }
        .btn-rojo {
            background-color: #d00000;
            color: white;
            border: none;
            padding: 6px 12px;
            cursor: pointer;
            border-radius: 5px;
            font-size: 14px;
        }
        .btn-rojo:hover {
            background-color: #a00000;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">Almacén de Partes</a>

            <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                    data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
                    aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon" style="filter: invert(1);"></span>
            </button>

            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item">
                        <button class="nav-link active" id="navIndex" onclick="showSection('indexSection')">
                            Búsqueda rápida
                        </button>
                    </li>
                    <li class="nav-item">
                        <button class="nav-link" id="navAvanzada" onclick="showSection('avanzadaSection')">
                            Búsqueda avanzada
                        </button>
                    </li>
                    <li class="nav-item">
                        <button class="nav-link" id="navTarjetas" onclick="showSection('tarjetasSection')">
                            Tarjetas MaxMin
                        </button>
                    </li>
                </ul>

                <form class="d-flex" role="search" onsubmit="event.preventDefault(); searchTableIndex();">
                    <input type="text" id="searchInputIndex" placeholder="Buscar..." oninput="searchTableIndex()">
                </form>
            </div>
        </div>
    </nav>

    <section id="indexSection" class="page-section" style="display:flex;">
        <h4 class="mb-3" style="color:#002b5c; font-weight:600;">Búsqueda rápida</h4>
        <div class="table-container" id="searchResultsIndex" style="display:none;">
            <table>
                <thead>
                    <tr id="tableHeaderIndex"></tr>
                </thead>
                <tbody id="tableBodyIndex"></tbody>
            </table>
        </div>
    </section>

    <section id="avanzadaSection" class="page-section">
        <h4 class="mb-3" style="color:#002b5c; font-weight:600;">Búsqueda avanzada</h4>
        <h6 class="text-center mb-3">¿Qué estás buscando?</h6>
        <input type="text" id="searchInputAvanzada" placeholder="Buscar..." oninput="searchTableAvanzada()">

        <div style="overflow-x: auto;">
            <table id="dataTable">
                <thead><tr id="tableHeaderAvanzada"></tr></thead>
                <tbody id="tableBodyAvanzada"></tbody>
            </table>
        </div>
    </section>

    <section id="tarjetasSection" class="page-section">
        <h4 class="mb-3" style="color:#002b5c; font-weight:600;">Solicitud de tarjetas de Máximos y Mínimos</h4>

        <input type="text" id="searchBarTarjetas"
               placeholder="Buscar por Código, Descripción..."
               onkeyup="filtrarTablaTarjetas()">

        <table id="excelTableTarjetas">
            <thead>
                <tr>
                    <th>Código</th>
                    <th>Descripción</th>
                    <th>Tarjeta MaxMin</th>
                </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
    </section>

    <div id="imgOverlay" class="img-overlay" hidden aria-modal="true" role="dialog">
        <button id="overlayClose" class="close" aria-label="Cerrar">×</button>
        <img id="overlayImg" alt="">
    </div>

    <script>
        function showSection(sectionId) {
            const sections = ['indexSection', 'avanzadaSection', 'tarjetasSection'];
            const navIds   = ['navIndex', 'navAvanzada', 'navTarjetas'];

            sections.forEach(id => {
                document.getElementById(id).style.display = (id === sectionId) ? 'block' : 'none';
            });

            navIds.forEach(id => {
                const btn = document.getElementById(id);
                if (!btn) return;
                if (id.toLowerCase().includes(sectionId.replace('Section','').toLowerCase())) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
        }

        let excelDataIndex = [];

        function loadExcelIndex() {
            fetch('https://docs.google.com/spreadsheets/d/18uMNnsWhB3LAKtgdsMGBN12T0r36K64h/edit?gid=232848370#gid=232848370')
                .then(response => response.arrayBuffer())
                .then(data => {
                    const workbook = XLSX.read(data, { type: 'array' });
                    const sheetName = workbook.SheetNames[0];
                    const sheet = workbook.Sheets[sheetName];
                    excelDataIndex = XLSX.utils.sheet_to_json(sheet, { header: 1 });
                })
                .catch(error => console.error("ERROR Index:", error.message));
        }

        function searchTableIndex() {
            const searchValue = document.getElementById('searchInputIndex').value.toLowerCase();
            const resultsContainer = document.getElementById('searchResultsIndex');
            const tableHeader = document.getElementById('tableHeaderIndex');
            const tableBody = document.getElementById('tableBodyIndex');

            tableHeader.innerHTML = "";
            tableBody.innerHTML = "";

            if (searchValue === "") {
                resultsContainer.style.display = "none";
                return;
            }

            resultsContainer.style.display = "block";
            if (excelDataIndex.length === 0) return;

            excelDataIndex[0].forEach(header => {
                const th = document.createElement("th");
                th.textContent = header;
                tableHeader.appendChild(th);
            });

            excelDataIndex.slice(1).forEach(row => {
                if (row.some(cell => cell && cell.toString().toLowerCase().includes(searchValue))) {
                    const tr = document.createElement("tr");

                    row.forEach(cell => {
                        const td = document.createElement("td");

                        if (typeof cell === "string" && (
        cell.startsWith("http://") ||
        cell.startsWith("https://") ||
        cell.endsWith(".jpg")  || cell.endsWith(".png")  ||
        cell.endsWith(".jpeg") || cell.endsWith(".gif")
    )) {

                            const btn = document.createElement("button");
                            btn.textContent = "Imagen";
                            btn.className = "btn btn-primary btn-sm";
                            btn.addEventListener("click", function () {
                                window.openOverlay(cell, "Imagen");
                            });
                            td.appendChild(btn);
                        } else {
                            td.textContent = cell;
                        }

                        tr.appendChild(td);
                    });

                    tableBody.appendChild(tr);
                }
            });
        }

        let excelDataAvanzada = [];

        function loadExcelAvanzada() {
            fetch('https://docs.google.com/spreadsheets/d/18uMNnsWhB3LAKtgdsMGBN12T0r36K64h/edit?gid=232848370#gid=232848370')
                .then(response => response.arrayBuffer())
                .then(data => {
                    const workbook = XLSX.read(data, { type: 'array' });
                    const sheetName = workbook.SheetNames[0];
                    const sheet = workbook.Sheets[sheetName];
                    excelDataAvanzada = XLSX.utils.sheet_to_json(sheet, { header: 1 });
                    displayTableAvanzada(excelDataAvanzada);
                })
                .catch(error => console.error("ERROR Avanzada:", error.message));
        }

        function displayTableAvanzada(data) {
            const tableHeader = document.getElementById('tableHeaderAvanzada');
            const tableBody = document.getElementById('tableBodyAvanzada');
            tableHeader.innerHTML = "";
            tableBody.innerHTML = "";

            if (data.length === 0) return;

            data[0].forEach(header => {
                const th = document.createElement("th");
                th.textContent = header;
                tableHeader.appendChild(th);
            });

            for (let i = 1; i < data.length; i++) {
                const row = document.createElement("tr");
                data[i].forEach(cell => {
                    const td = document.createElement("td");

                    if (typeof cell === "string" && (
        cell.startsWith("http://") ||
        cell.startsWith("https://") ||
        cell.endsWith(".jpg")  || cell.endsWith(".png")  ||
        cell.endsWith(".jpeg") || cell.endsWith(".gif")
    )) {

                        const img = document.createElement("img");
                        img.src = cell;
                        img.loading = "lazy";
                        img.decoding = "async";
                        img.classList.add("tabla-img", "zoomable");
                        img.alt = "Imagen";
                        td.appendChild(img);
                    } else {
                        td.textContent = cell;
                    }

                    row.appendChild(td);
                });
                tableBody.appendChild(row);
            }
        }

        function searchTableAvanzada() {
            const searchValue = document.getElementById('searchInputAvanzada').value.toLowerCase();
            const rows = document.querySelectorAll("#tableBodyAvanzada tr");

            rows.forEach(row => {
                let cells = row.querySelectorAll("td");
                let match = false;

                for (let i = 0; i < Math.min(3, cells.length); i++) {
                    if (cells[i].textContent.toLowerCase().includes(searchValue)) {
                        match = true;
                        break;
                    }
                }

                row.style.display = match ? "" : "none";
            });
        }

        const excelFilePathTarjetas = "archivos/datos.xlsx";

        function loadExcelTarjetas() {
            fetch(excelFilePathTarjetas)
                .then(response => response.arrayBuffer())
                .then(data => {
                    const workbook = XLSX.read(data, { type: "array" });
                    const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                    const jsonData = XLSX.utils.sheet_to_json(firstSheet, { header: 1 });

                    const tbody = document.querySelector("#excelTableTarjetas tbody");

                    jsonData.slice(1).forEach(row => {
                        if (row.length >= 3) {
                            const codigo = row[0];
                            const descripcion = row[1];
                            const pdfPath = row[2];

                            const tr = document.createElement("tr");
                            tr.innerHTML = `
                                <td>${codigo}</td>
                                <td>${descripcion}</td>
                                <td>
                                    <button class="btn-rojo" onclick="imprimirPDFTarjetas('${pdfPath}')">Imprimir</button>
                                </td>
                            `;
                            tbody.appendChild(tr);
                        }
                    });
                });
        }

        function imprimirPDFTarjetas(ruta) {
            const win = window.open(ruta, "_blank");
            win.print();
        }

        function filtrarTablaTarjetas() {
            const input = document.getElementById("searchBarTarjetas").value.toLowerCase();
            const filas = document.querySelectorAll("#excelTableTarjetas tbody tr");

            filas.forEach(fila => {
                const textoFila = fila.innerText.toLowerCase();
                fila.style.display = textoFila.includes(input) ? "" : "none";
            });
        }

        (function () {
            const overlay = document.getElementById('imgOverlay');
            const overlayImg = document.getElementById('overlayImg');
            const closeBtn = document.getElementById('overlayClose');

            window.openOverlay = function (src, alt) {
                overlayImg.src = src;
                overlayImg.alt = alt || '';
                overlay.removeAttribute('hidden');
                document.body.style.overflow = 'hidden';
            };

            function closeOverlay() {
                overlay.setAttribute('hidden', '');
                document.body.style.overflow = '';
                overlayImg.src = '';
                overlayImg.alt = '';
            }

            closeBtn.addEventListener('click', closeOverlay);
            overlay.addEventListener('click', (e) => {
                if (e.target === overlay) closeOverlay();
            });
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && !overlay.hasAttribute('hidden')) closeOverlay();
            });

            document.addEventListener('click', (e) => {
                const img = e.target.closest('img.zoomable');
                if (img) {
                    const full = img.dataset.full || img.src;
                    window.openOverlay(full, img.alt);
                }
            });
        })();

        window.addEventListener('load', () => {
            loadExcelIndex();
            loadExcelAvanzada();
            loadExcelTarjetas();
            showSection('indexSection'); 
        });
    </script>
</body>
</html>







